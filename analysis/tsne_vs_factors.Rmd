---
title: "Linear vs. nonlinear embeddings: a thought experiment"
author: Peter Carbonetto
output: workflowr::wflow_html
---

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

Load the packages used in the analysis below, and set the seed.

```{r setup, message=FALSE}
library(mvtnorm)
library(Rtsne)
library(flashier)
library(ggplot2)
library(cowplot)
set.seed(1)
```

Consider the following data set. The 2-d data vectors are simulated so
that they cluster into two sets. The second cluster varies much more
along the second data dimension.

```{r sim-data, fig.width=3.5, fig.height=2.5}
X <- rbind(rmvnorm(100,c(-1,0),diag(2)/30),
           rmvnorm(900,c(+1,0),diag(c(0.1,3))))
cluster <- factor(c(rep(1,100),rep(2,900)))
colnames(X) <- c("x1","x2")
p1 <- qplot(X[,1],X[,2],shape = I(21),color = I("white"),fill = cluster) +
  scale_fill_manual(values = c("tomato","dodgerblue")) +
  xlim(-6,6) +
  ylim(-6,6) +
  labs(x = "x1",y = "x2") +
  theme_cowplot(font_size = 12)
print(p1)
```

*Question:* Is there a (linear) matrix factorization method that
will produce a 1-d representation that correctly subdivides the points
into the two clusters?

Unsurprisingly, PCA doesn't work---the first PC picks up variation in
the second cluster.

```{r pca, fig.width=3, fig.height=2}
pca <- drop(prcomp(X)$x[,1])
pdat <- data.frame(cluster,pca)
p2 <- ggplot(pdat,aes(x = cluster,y = pca)) +
  geom_boxplot(width = 0.25) +
  theme_cowplot(font_size = 12)
print(p2)
```

On the other hand, the 1-d embedding generated by *t*-SNE is able to
clearly distinguish the two clusters.

```{r tsne, fig.width=3, fig.height=2.5}
tsne <- drop(Rtsne(X,dims = 1,perplexity = 30,theta = 0.1,max_iter = 1000,
                   eta = 200,normalize = FALSE,pca = FALSE,verbose = FALSE)$Y)
pdat <- data.frame(cluster,tsne)
p3 <- ggplot(pdat,aes(x = cluster,y = tsne)) +
  geom_boxplot(width = 0.25) +
  theme_cowplot(font_size = 12)
print(p3)
```

FLASH with one factor does no better than PCA in separating the two
clusters.

```{r flash, fig.width=3, fig.height=2.5}
fl <- flash(X,greedy.Kmax = 1,nullcheck = FALSE,verbose.lvl = 0)
fl <- drop(fl$loadings.pm[[1]])
pdat <- data.frame(cluster,flash = fl)
p4 <- ggplot(pdat,aes(x = cluster,y = flash)) +
  geom_boxplot(width = 0.25) +
  theme_cowplot(font_size = 12)
print(p4)
```
